<!DOCTYPE html>
.not-found {
color: red;
}
</style>
</head>
<body>
<h1>UPC Checker</h1>
<p>Scan a barcode to see if it exists in your list.</p>
<div id="reader"></div>
<div id="result" class="result"></div>


<script>
let upcList = [];


// Replace with your published Google Sheet CSV link
const sheetUrl = "https://docs.google.com/spreadsheets/d/XXXXX/pub?output=csv";


// Replace with your Google Apps Script Web App URL
const webAppUrl = "YOUR_WEB_APP_URL";


// Load UPCs from Google Sheet
async function loadUPCs() {
try {
const response = await fetch(sheetUrl);
const text = await response.text();
upcList = text.split("\n").map(line => line.trim());
console.log("UPC list loaded:", upcList);
} catch (err) {
console.error("Error loading UPC list:", err);
}
}


// Run this when the page loads
loadUPCs();


function onScanSuccess(decodedText) {
const resultDiv = document.getElementById("result");
if (upcList.includes(decodedText)) {
resultDiv.textContent = `✅ FOUND: ${decodedText}`;
resultDiv.className = "result found";


// Get GPS location
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(function(pos) {
const lat = pos.coords.latitude;
const lng = pos.coords.longitude;


// Send UPC + GPS to Google Apps Script
fetch(webAppUrl, {
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify({ upc: decodedText, lat: lat, lng: lng })
})
.then(res => res.text())
.then(msg => console.log("Google Sheet response:", msg))
.catch(err => console.error("Error sending to Google Sheet:", err));


}, function(err) {
console.error("GPS error:", err);
});
} else {
console.error("Geolocation not supported.");
}


} else {
resultDiv.textContent = `❌ NOT FOUND: ${decodedText}`;
resultDiv.className = "result not-found";
}
}


const html5QrcodeScanner = new Html5QrcodeScanner(
"reader",
{ fps: 10, qrbox: 250 },
false
);
html5QrcodeScanner.render(onScanSuccess);
</script>
</body>
</html>
